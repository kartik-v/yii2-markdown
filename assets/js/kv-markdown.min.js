/*!
 * ====================================================
 * kv-markdown.js
 * ====================================================
 * A markdown editor parser for PHP Markdown Extra and
 * PHP SmartyPants. Designed for Yii Framework 2.0
 *
 * https://github.com/kartik-v/yii2-markdown
 *
 * Copyright (c) 2013, Kartik Visweswaran
 * Krajee.com
 * Licensed under BSD-3 License.
 * Refer attached LICENSE.md for details.
 * Version: 1.0.1
 * Build date: 6 September 2013
 */
;String.prototype.trimRight=function(a){if(a===undefined){a="s"}return this.replace(new RegExp("["+a+"]+$"),"")};String.prototype.repeat=function(a){a=a||1;return Array(a+1).join(this)};function isEmpty(b,a){return b===null||b===undefined||b==[]||b===""||a&&$.trim(b)===""}function isNumber(a){return !isNaN(parseFloat(a))&&isFinite(a)}function genSaveFile(g,a,e,c,f,d,b){alert(f);output=a+e;if(c=="HTML"){$.ajax({type:"POST",url:d,dataType:"json",data:{source:output,nullMsg:b},success:function(i){if(i){url="data:x-application/text,"+escape(g+i);window.open(url)}else{alert("HTML conversion failed! Try again later.")}}})}else{url="data:x-application/text,"+escape(output);window.open(url)}}function togglePreview(i){var c=i.editor,f=i.preview,d=i.source,e=i.target,b=i.url,a=i.progress,g=i.nullMsg;$(f).toggleClass("active");if($(e).hasClass("hidden")){disableButtons(c);$(f).removeAttr("disabled");$(d).addClass("hidden");$(e).removeClass("hidden");$.ajax({type:"POST",url:b,dataType:"json",data:{source:$(d).val(),nullMsg:g},beforeSend:function(){$(e).html(a)},success:function(j){$(e).html(j)}});$(e).focus()}else{enableButtons(c);$(d).removeClass("hidden");$(e).addClass("hidden");$(d).focus()}}function enableButtons(a){$(a+" button").each(function(){$(this).removeAttr("disabled")})}function disableButtons(a){$(a+" button").each(function(){if($(this).attr("data-enabled")==undefined){$(this).attr("disabled","disabled")}})}function getMarkUp(b,d,c){var a=d.length,f=c.length;var e=b;if(a>0){e=(e.slice(0,a)==d)?e.slice(a):d+e}if(f>0){e=(e.slice(-f)==c)?e.slice(0,-f):e+c}return e}function getBlockMarkUp(a,c,b){var e=a;if(e.indexOf("\n")<0){e=getMarkUp(a,c,b)}else{var d=[];d=a.split("\n");$.each(d,function(g,f){d[g]=getMarkUp(f.trimRight(),c,b+"  ")});e=d.join("\n")}return e}function markUp(c,a){var b=$(a);b.focus();var g=b.extractSelectedText(),j=g.length,l=g;if(c==1){l=(g.length>0)?getBlockMarkUp(g,"**","**"):"**(bold text here)**"}else{if(c==2){l=(g.length>0)?getBlockMarkUp(g,"*","*"):"*(italic text here)*"}else{if(c==3){l=(g.length>0)?getMarkUp(g,"\n","\n"):"\n(paragraph text here)\n"}else{if(c==4){l=getBlockMarkUp(g,"","  ")}else{if(c>100){n=c-100;var e="#".repeat(n);l=getMarkUp(g,e+" "," "+e)}else{if(c==5){link=prompt("Insert Hyperlink","http://");l=(link!=null&&link!=""&&link!="http://")?"["+g+"] ("+link+")":g}else{if(c==6){link=prompt("Insert Image Hyperlink","http://");l=(link!=null&&link!=""&&link!="http://")?"!["+g+"] ("+link+' "enter image title here")':g}else{if(c==7){var l=g,d="  ";if(l.indexOf("\n")<0){l=d+l}else{var k=[];k=g.split("\n");$.each(k,function(m,i){k[m]=d+i});l=k.join("\n")}}else{if(c==8){var l=g,d="  ";if(l.indexOf("\n")<0&&l.substr(0,2)==d){l=l.slice(2)}else{var k=[];k=g.split("\n");$.each(k,function(m,i){k[m]=i;if(i.substr(0,2)==d){k[m]=i.slice(2)}});l=k.join("\n")}}else{if(c==9){l=getBlockMarkUp(g,"- ","")}else{if(c==10){start=prompt("Enter starting number",1);if(start!=null&&start!=""){if(!isNumber(start)){start=1}if(g.indexOf("\n")<0){l=getMarkUp(g,start+". ","")}else{var k=[],f=start;k=g.split("\n");$.each(k,function(m,i){k[m]=getMarkUp(i,f+". ","");f++});l=k.join("\n")}}}else{if(c==11){if(g.indexOf("\n")>0){var k=[],f=1;k=g.split("\n");$.each(k,function(m,i){tag=(f%2==0)?":    ":"";k[m]=getMarkUp(i,tag,"");f++});l=k.join("\n")}else{l=g+"\n:    \n"}}else{if(c==12){title="Enter footnote ";notes="";if(g.indexOf("\n")<0){notes="[^1]: "+title+"1\n";l=getMarkUp(g,"",title+"[^1]")+"\n"+notes}else{var k=[],f=1;k=g.split("\n");$.each(k,function(m,i){id="[^"+f+"]";k[m]=getMarkUp(i,"",id+"  ");notes=notes+id+": "+title+f+"\n";f++});l=k.join("\n")+"  \n\n"+notes}}else{if(c==13){l=getBlockMarkUp(g,"> ","  ")}else{if(c==14){l=getMarkUp(g,"`","`")}else{if(c==15){lang=prompt("Enter code language (e.g. html)","");if(isEmpty(lang,true)){lang=""}l=getMarkUp(g,"~~~"+lang+" \n","\n~~~  \n")}else{if(c==16){l=getMarkUp(g,"","\n- - -")}}}}}}}}}}}}}}}}}if(!isEmpty(l)){b.replaceSelectedText(l,"select")}}function toggleScreen(c,a,d,e,f,b){h=$(window).height();if($(c).hasClass("active")){$(c).removeClass("active");val=$(e+" textarea").val();$(e+" textarea").height(b);$(e+" "+f).css("max-height",b);$(e+" "+d).clone(true).appendTo(a);$(a+" textarea").val(val);$(e+" "+d).remove();$(".kv-fullscreen").modal("hide")}else{$(c).addClass("active");val=$(a+" textarea").val();$(a+" "+d).clone(true).appendTo(e);$(a+" "+d).remove();$(e+" textarea").height(0.75*h);$(e+" "+f).css("max-height",0.75*h);$(e+" textarea").val(val);$(".kv-fullscreen").modal("show")}}function initEditor(d){var k=d.source,g=d.editor,i=d.preview,j=d.target,f=d.maximize,c=d.container,l=g.slice(1)+"-modal",b=d.save1,a=d.save2,e=d.height;$(k).focus(function(){$(g).addClass("active")});$(k).blur(function(){$(g).removeClass("active")});$(i).click(function(){togglePreview(d)});$(b).click(function(){genSaveFile("",d.saveHeader,$(k).val(),"Text",d.saveText,d.url,d.nullMsg)});$(a).click(function(){genSaveFile(d.saveCss,d.saveHeader,$(k).val(),"HTML",d.saveHtml,d.url,d.nullMsg)});$("body").remove(".kv-fullscreen");$("body").append('<div class="modal fade kv-fullscreen" data-backdrop="static" data-keyboard=false><div class="modal-dialog"><div  id="'+l+'" class="modal-content"></div></div></div>');l="#"+l;$(g+" "+j).css("max-height",e);$(g+" textarea").height(e);$(f).click(function(){toggleScreen(f,c,g,l,j,e)})};